<plan phase="21" plan="1">
  <overview>
    <phase_name>Test Reliability Baseline</phase_name>
    <goal>Establish 5+ baseline unit tests for apps/web with CI integration and coverage ratchet</goal>
  </overview>

  <dependencies>
    <complete>Phase 20: Gate Enforcement Hardening</complete>
  </dependencies>

  <tasks>
    <task type="auto" priority="1">
      <name>Create skill validation tests</name>
      <files>apps/web/src/validation/skill.test.ts</files>
      <action>
        Implement unit tests for validateSkillFrontmatter() and extractTriggers():
        - Test valid frontmatter parsing
        - Test missing frontmatter detection
        - Test required field validation (name, description)
        - Test invalid YAML handling
        - Test trigger extraction scenarios
      </action>
      <verify>8 tests pass with pnpm run test</verify>
      <done>skill.test.ts with 8 comprehensive tests</done>
    </task>

    <task type="auto" priority="1">
      <name>Create plan parsing tests</name>
      <files>apps/web/src/parsing/plan.test.ts</files>
      <action>
        Implement unit tests for parsePlanFile() and countTasksByType():
        - Test parsing plan with frontmatter and tasks
        - Test empty task handling
        - Test default type assignment
        - Test task counting by type
      </action>
      <verify>5 tests pass with pnpm run test</verify>
      <done>plan.test.ts with 5 tests covering XML plan parsing</done>
    </task>

    <task type="auto" priority="1">
      <name>Create coverage ratchet tests</name>
      <files>apps/web/src/live/coverage-ratchet.test.ts</files>
      <action>
        Implement integration tests for coverage-ratchet.cjs script:
        - Test baseline creation when missing (local)
        - Test CI failure when baseline missing
        - Test coverage improvement detection
        - Use temp directories to avoid side effects
      </action>
      <verify>3 tests pass with pnpm run test</verify>
      <done>coverage-ratchet.test.ts with isolated temp directory tests</done>
    </task>

    <task type="auto" priority="1">
      <name>Create sc-reflect-live tests</name>
      <files>apps/web/src/live/sc-reflect-live.test.ts</files>
      <action>
        Implement tests for skill-creator reflection utilities:
        - Test skill metadata extraction
        - Test reflection result formatting
        - Test error handling scenarios
      </action>
      <verify>4 tests pass with pnpm run test</verify>
      <done>sc-reflect-live.test.ts with 4 tests</done>
    </task>

    <task type="auto" priority="1">
      <name>Wire tests to CI quality gate</name>
      <files>.github/workflows/ci.yml, package.json</files>
      <action>
        Ensure test gate runs apps/web tests and coverage ratchet:
        - test:web:ci script runs tests + coverage ratchet
        - CI workflow calls quality-gate.sh --gate test
        - quality-gate.sh routes to pnpm run test:web:ci
      </action>
      <verify>CI workflow passes with test gate</verify>
      <done>test gate integrated in CI pipeline</done>
    </task>

    <task type="auto" priority="2">
      <name>Commit initial coverage baseline</name>
      <files>apps/web/.coverage/baseline.json</files>
      <action>
        Generate and commit initial coverage baseline:
        - Run pnpm run test:coverage:update
        - Commit baseline.json to version control
        - Baseline: ~98% lines, 100% functions, 95% branches
      </action>
      <verify>baseline.json exists and is tracked in git</verify>
      <done>Coverage baseline committed and version-controlled</done>
    </task>

  </tasks>
</plan>
