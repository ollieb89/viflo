# Plan 07-03: Telemetry Logging

<plan phase="7" plan="3">
  <overview>
    <phase_name>Content Hygiene â€” Telemetry Logging</phase_name>
    <goal>Create telemetry logging script and CSV storage for LLM usage tracking</goal>
  </overview>
  
  <dependencies>
    <complete>Plan 07-02: VERIFICATION.md backfill complete</complete>
  </dependencies>
  
  <reference>
    <context>07-CONTEXT.md</context>
    <requirement>CONTENT-03</requirement>
  </reference>

  <tasks>
    <task type="auto" priority="1">
      <name>Create .telemetry/ directory</name>
      <files>.telemetry/</files>
      <action>
        Create .telemetry/ directory at repo root for CSV storage.
        Add .gitkeep or README explaining purpose.
      </action>
      <verify>Directory exists</verify>
    </task>

    <task type="auto" priority="1">
      <name>Create telemetry CSV with headers</name>
      <files>.telemetry/usage.csv</files>
      <action>
        Create usage.csv with schema:
        timestamp,model,prompt_tokens,completion_tokens,task_success,task_type,duration_ms,notes
        
        Use RFC 3339 timestamps (2026-02-23T22:19:12+01:00).
        task_success: true/false
        task_type: plan|execute|verify|discuss|quick
      </action>
      <verify>CSV file exists with correct headers</verify>
    </task>

    <task type="auto" priority="1">
      <name>Create telemetry logging script</name>
      <files>scripts/log-telemetry.sh</files>
      <action>
        Create bash script that appends to .telemetry/usage.csv:
        - Validates input arguments
        - Generates timestamp
        - Appends row in correct format
        - Creates backup if file > 10MB
        
        Usage: ./scripts/log-telemetry.sh "claude-3-opus" 1500 3200 true "execute" 45000 "Phase 6 tests"
      </action>
      <verify>Script exists, executable, validates inputs</verify>
    </task>

    <task type="auto" priority="1">
      <name>Add sample data rows</name>
      <files>.telemetry/usage.csv</files>
      <action>
        Add 3-5 sample rows demonstrating schema:
        - Phase 5 CI setup execution
        - Phase 6 test suite execution
        - Quick task example
        - Manual verification example
      </action>
      <verify>At least 3 sample rows in CSV</verify>
      <done>CSV opens correctly in spreadsheet tool</done>
    </task>

    <task type="auto" priority="2">
      <name>Create telemetry analysis script</name>
      <files>scripts/telemetry-report.sh</files>
      <action>
        Create script to generate reports from usage.csv:
        - Total tokens by model
        - Success rate by task type
        - Average duration
        - Daily/weekly summary
        
        Output: Markdown report or CSV summary
      </action>
      <verify>Script generates valid reports</verify>
    </task>

    <task type="auto" priority="2">
      <name>Add telemetry documentation</name>
      <files>.telemetry/README.md</files>
      <action>
        Document telemetry system:
        - Schema explanation
        - How to log usage
        - How to generate reports
        - Privacy considerations
        - Retention policy
      </action>
      <verify>README.md complete and accurate</verify>
    </task>

    <task type="auto" priority="2">
      <name>Update .gitignore for telemetry</name>
      <files>.gitignore</files>
      <action>
        Ensure .telemetry/usage.csv is NOT ignored (we want to commit it).
        Add comment explaining telemetry is committed for historical record.
      </action>
      <verify>.telemetry/usage.csv not in .gitignore</verify>
    </task>

    <task type="auto" priority="3">
      <name>Test telemetry logging end-to-end</name>
      <files>scripts/log-telemetry.sh, .telemetry/usage.csv</files>
      <action>
        Run script with test data, verify:
        - Row appends correctly
        - CSV remains valid
        - Timestamp format correct
        - Special characters handled
      </action>
      <verify>Script works correctly, CSV valid</verify>
    </task>
  </tasks>
</plan>
