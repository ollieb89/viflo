---
milestone: v1.4
name: Project Tooling
audited: 2026-02-24T14:30:00Z
status: tech_debt
scope: Phases 15–16 only (Phases 17–19 deferred to v1.5)
scores:
  requirements: 4/4
  phases: 2/2
  integration: 8/8
  flows: 2/2
gaps: []
tech_debt:
  - phase: 15-integration-review
    items:
      - "agent-architecture/SKILL.md is 503 lines (over 500-line limit). Accepted and documented in VERIFICATION.md — trimming was explicitly ruled out per locked phase decision. 4/5 skills within limit is the accepted outcome."
  - phase: 16-cli-foundation
    items:
      - "writeIfChanged helper is not exported from writers.cjs. If Phase 17+ needs to write additional file types, it must either extend writers.cjs or duplicate the idempotency logic. Note for Phase 17 planning."
      - "resolveViFloRoot() is exported and tested but not yet called within the bin/ tree — correctly deferred to Phase 17+ which will use it to locate skill templates and scaffold stubs."
  - phase: planning-docs
    items:
      - "ROADMAP.md Phase 17 success criterion (line 97) still uses stale sentinel format viflo:start / viflo:end. Phase 16 locked the sentinel as <!-- BEGIN VIFLO --> / <!-- END VIFLO -->. Must be updated before Phase 17 planning begins or implementer will build against wrong contract."
      - "research/ARCHITECTURE.md, research/SUMMARY.md, research/STACK.md, research/PITFALLS.md all reference stale viflo:start / viflo:end format. These are planning-only artifacts with no code impact, but should be updated before Phase 17 research begins."
---

# Milestone v1.4 — Project Tooling — Audit Report

**Audited:** 2026-02-24
**Scope:** Phases 15–16 (Phases 17–19 deferred to v1.5 per user decision)
**Status:** tech_debt — all 4 requirements met, no critical blockers, 4 minor tech debt items

---

## Requirements Coverage

All 4 requirements scoped to Phases 15–16 are satisfied across all 3 independent sources.

| Requirement | Phase | Description | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|-------------|-------|-------------|-----------------|---------------------|-----------------|--------------|
| INFRA-01 | 15 | INDEX.md updated with entries for all five v1.4 skills | SATISFIED | [INFRA-01] in 15-01 | [x] Complete | **satisfied** |
| INFRA-02 | 15 | All new/updated SKILL.md files verified ≤500 lines with line counts recorded | SATISFIED | [INFRA-02] in 15-03 | [x] Complete | **satisfied** |
| INFRA-03 | 15 | Cross-reference links between RAG ↔ Agent Architecture ↔ Prompt Engineering | SATISFIED | [INFRA-03] in 15-02 | [x] Complete | **satisfied** |
| INIT-05 | 16 | Re-running `viflo init` does not overwrite customized content | SATISFIED | [INIT-05] in 16-02 | [x] Complete | **satisfied** |

**Requirements in scope deferred to v1.5:** INIT-01, INIT-02, INIT-03, INIT-04, INIT-06, INIT-07 (Phases 17–19)

**Orphaned requirements:** None. All 4 scoped requirements appear in both VERIFICATION.md tables and SUMMARY frontmatter.

---

## Phase Verification Summary

| Phase | Status | Score | Notes |
|-------|--------|-------|-------|
| 15: Integration Review | **passed** | 8/8 | All truths verified; no anti-patterns; 6/6 cross-reference links confirmed |
| 16: CLI Foundation | **passed** | 9/9 | All truths verified; 23/23 tests pass (190ms); stale sentinel in JSDoc comment only (no runtime impact) |

---

## Integration Assessment

| Area | Result | Notes |
|------|--------|-------|
| Cross-phase wiring | Clean | Phase 15 → Phase 16 boundary is architectural (content finalized before writers built), not programmatic — no require/import crossing |
| Dependency chain | Clean | Phase 15 completion cleanly unblocks Phase 16; no circular dependencies |
| Within-scope exports | All wired | 8/8 exports connected: paths.cjs → writers.cjs → test suite; INDEX.md and skill cross-refs accessible as documented |
| Orphaned exports | None | resolveViFloRoot not yet called within bin/ tree — correctly deferred to Phase 17; not orphaned |
| Stale constants | None in code | Stale viflo:start/viflo:end sentinel exists only in planning/research docs, not in any implementation file |

---

## E2E Flow Traces

### Flow 1: Skill Discovery (Phase 15) — Complete

A developer opens `.agent/skills/INDEX.md` to find a relevant skill:

1. ✅ INDEX.md intro paragraph explains the skill library and loading mechanism (line 3)
2. ✅ All five v1.4 skills appear in categorized tables with accurate descriptions
3. ✅ Developer loads a skill and follows See Also links to related skills — all 6 bidirectional links confirmed present and at correct line numbers
4. ✅ Line counts: 4/5 skills within 500-line limit; agent-architecture at 503 correctly flagged ✗ with explanatory note

### Flow 2: Developer Runs `viflo init` — Idempotency Foundation (Phase 16) — Library layer complete; entry point deferred to Phase 17

What the Phase 16 library layer guarantees:

1. ✅ `resolveViFloRoot()` returns absolute viflo repo root via `__dirname`-based resolution
2. ✅ `resolveTargetPath(cwd, ...segments)` constructs target project paths; throws on missing cwd
3. ✅ `writeCLAUDEmd` — sentinel-aware merge; creates/appends/replaces; throws on duplicate sentinels
4. ✅ `writeSettingsJson` — deep-merge with Set-based array deduplication; existing keys preserved; scalars: incoming wins
5. ✅ Both writers return `{ written: boolean, reason: string }` — correct interface for Phase 17 orchestrator
6. ✅ `pnpm run test:cli` regression gate: 23 tests, exit 0, 190ms

Phase 17 handoff is clean: needs only to `require('./lib/writers.cjs')` and `require('./lib/paths.cjs')`, supply content and cwd.

---

## Tech Debt by Phase

### Phase 15: Integration Review

**1. agent-architecture/SKILL.md at 503 lines (low severity)**
- The 500-line limit is exceeded by 3 lines
- Accepted outcome: trimming was explicitly ruled out per locked phase decision
- Correctly documented in `.agent/skills/VERIFICATION.md` with explanatory note
- 4/5 skills within limit is the accepted pass state for Phase 15
- Impact: cosmetic; no functionality affected

### Phase 16: CLI Foundation

**2. `writeIfChanged` not exported (low severity)**
- The core idempotency primitive is internal to `writers.cjs`
- Phase 17+ may need to extend for additional file types
- Mitigation: extend `writers.cjs` rather than duplicating the logic

**3. `resolveViFloRoot()` has no consumers within `bin/` (info — expected)**
- Correctly deferred to Phase 17 (CLI entry point)
- Not orphaned; forward contract established in CONTEXT.md

### Planning Documents

**4. Stale sentinel format in ROADMAP.md Phase 17 criterion (medium — must fix before Phase 17 planning)**
- ROADMAP.md line 97 reads `<!-- viflo:start -->` / `<!-- viflo:end -->`
- Implemented sentinel (confirmed in writers.cjs lines 7-8) is `<!-- BEGIN VIFLO -->` / `<!-- END VIFLO -->`
- Also present in: research/ARCHITECTURE.md, research/SUMMARY.md, research/STACK.md, research/PITFALLS.md
- **Action required:** Update ROADMAP.md Phase 17 success criterion before Phase 17 planning begins
- No code impact; planning documents only

### Total: 4 items across 3 areas (1 medium, 1 low, 1 low, 1 info)

---

## Summary

Milestone v1.4 (scoped to Phases 15–16) achieves all requirements within scope:

- **Phase 15** closes the housekeeping debt from v1.3: INDEX.md is accurate, cross-references are bidirectional, and 500-line compliance is audited and documented.
- **Phase 16** establishes the idempotent writer foundation for the viflo CLI: `paths.cjs` and `writers.cjs` are tested, correct, and ready for Phase 17 to build on.

No critical blockers. The one actionable item before next milestone planning is updating the stale sentinel format string in ROADMAP.md Phase 17's success criterion.

---

_Audited: 2026-02-24T14:30:00Z_
_Auditor: Claude (gsd-audit-milestone)_
